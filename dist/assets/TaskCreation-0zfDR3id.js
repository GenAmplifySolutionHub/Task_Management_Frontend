import{w as z,x,ab as $,a5 as R,v as ge,r as l,j as c,a as t,D as Y,c as V,y as f,z as U,a6 as _e,a7 as G,d as J,B as k,e as K,a9 as Te,ac as De,A as Se,C as Ee,M as fe,s as Q,H as ye,J as W,K as X,f as B,Q as be,U as Ie,V as ke,W as Ce,g as O,X as Ae,ad as xe,ae as we,_ as ve,T as j,N as Be,P as Pe}from"./vendor-BtQO_-CK.js";import{a as qe}from"./styles-sAMJ7xpl.js";import{c as Fe,g as Z,u as $e,a as Le,i as Me}from"./TaskRoutes-BUeGv23s.js";import{D as Ne}from"./dataRenderLayoutOrg-BQot4ltY.js";import{u as He}from"./index-CzmVGMce.js";const F=()=>new Date().toTimeString().slice(0,5),q=()=>new Date().toISOString().split("T")[0],We=z({Task_Details:x().required("Task Details are required"),Start_Date:$().required("Start Date is required").test("is-future-date","Start Date cannot be in the past",function(r){const i=new Date,o=new Date(i.getFullYear(),i.getMonth(),i.getDate());return r>=o}),Start_Time:x().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format").required("Start Time is required").test("is-future-time","You cannot select a past time",function(r){const{Start_Date:i}=this.parent,o=new Date,d=new Date(i);return d.setHours(parseInt(r.split(":")[0],10)),d.setMinutes(parseInt(r.split(":")[1],10)),d>=o}),Assigned_Emp_Id:R().required("Assigned employe is required"),End_Time:x().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format").required("End Time is required").test("is-end-time-valid","End Time must be after Start Time",function(r){const{Start_Date:i,Start_Time:o,End_Date:d}=this.parent,e=new Date(i),m=new Date(d),T=new Date(`${e.toISOString().split("T")[0]}T${o}:00`),g=new Date(`${m.toISOString().split("T")[0]}T${r}:00`);console.log("Start DateTime:",T),console.log("End DateTime:",g);const h=e.getFullYear()===m.getFullYear()&&e.getMonth()===m.getMonth()&&e.getDate()===m.getDate();if(console.log("Same Day:",h),h){const D=parseInt(o.split(":")[0],10),_=parseInt(o.split(":")[1],10),A=parseInt(r.split(":")[0],10),y=parseInt(r.split(":")[1],10),p=D*60+_;return A*60+y<=p?this.createError({path:"End_Time",message:"End Time must be after Start Time"}):!0}return m>e})}),Oe=({open:r,onClose:i,projectId:o,fetchTasks:d})=>{const e=ge({initialValues:{Task_Details:"",Start_Date:q(),Start_Time:F(),End_Date:q(),End_Time:F(),Assigned_Emp_Id:null},validationSchema:We,onSubmit:async s=>{const a={Project_Id:o,Start_Date:s.Start_Date,Start_Time:s.Start_Time,Task_Details:s.Task_Details,End_Date:s.End_Date,End_Time:s.End_Time,Assigned_Emp_Id:s.Assigned_Emp_Id};try{const b=await Fe(a);d(),i()}catch(b){console.error("Error creating task:",b)}}}),[m,T]=l.useState([]),[g,h]=l.useState(!0),[D,_]=l.useState(null),[A,y]=l.useState(""),[p,u]=l.useState(0),[C,S]=l.useState(0);return l.useEffect(()=>{r&&(async()=>{h(!0);try{const a=await Z(o,A,10,C);T(a)}catch(a){_("Failed to fetch project employees."),console.error("Error fetching employees:",a)}finally{h(!1)}})()},[r,o,A,p]),c(K,{open:r,onClose:i,children:[t(Y,{children:"Add New Task"}),c("form",{onSubmit:e.handleSubmit,children:[c(V,{children:[t(f,{autoFocus:!0,margin:"dense",label:"Task Details",type:"text",fullWidth:!0,variant:"outlined",name:"Task_Details",value:e.values.Task_Details,onChange:e.handleChange,onBlur:e.handleBlur,error:e.touched.Task_Details&&!!e.errors.Task_Details,helperText:e.touched.Task_Details&&e.errors.Task_Details}),t(f,{margin:"dense",label:"Start Date",type:"date",fullWidth:!0,variant:"outlined",name:"Start_Date",value:e.values.Start_Date,onChange:e.handleChange,onBlur:e.handleBlur,error:e.touched.Start_Date&&!!e.errors.Start_Date,helperText:e.touched.Start_Date&&e.errors.Start_Date,InputLabelProps:{shrink:!0},inputProps:{min:q()}}),t(f,{margin:"dense",label:"Start Time",type:"time",fullWidth:!0,variant:"outlined",name:"Start_Time",value:e.values.Start_Time,onChange:e.handleChange,onBlur:e.handleBlur,error:e.touched.Start_Time&&!!e.errors.Start_Time,helperText:e.touched.Start_Time&&e.errors.Start_Time,InputLabelProps:{shrink:!0},inputProps:{min:F()}}),t(f,{margin:"dense",label:"End Date",type:"date",fullWidth:!0,variant:"outlined",name:"End_Date",value:e.values.End_Date,onChange:e.handleChange,onBlur:e.handleBlur,error:e.touched.End_Date&&!!e.errors.End_Date,helperText:e.touched.End_Date&&e.errors.End_Date,InputLabelProps:{shrink:!0},inputProps:{min:q()}}),t(f,{margin:"dense",label:"End Time",type:"time",fullWidth:!0,variant:"outlined",name:"End_Time",value:e.values.End_Time,onChange:e.handleChange,onBlur:e.handleBlur,error:e.touched.End_Time&&!!e.errors.End_Time,helperText:e.touched.End_Time&&e.errors.End_Time,InputLabelProps:{shrink:!0}}),c(U,{fullWidth:!0,margin:"dense",error:e.touched.Assigned_Emp_Id&&!!e.errors.Assigned_Emp_Id,children:[t(_e,{options:m,getOptionLabel:s=>s.Employee.Employee_name,onChange:(s,a)=>{e.setFieldValue("Assigned_Emp_Id",a?a.Emp_Id:"")},onInputChange:(s,a)=>{y(a),S(0),T([])},onScroll:s=>{const a=s.target;a.scrollHeight===a.scrollTop+a.clientHeight&&!g&&S(I=>I+1)},renderInput:s=>t(f,{...s,label:"Assigned Employee",variant:"outlined",error:e.touched.Assigned_Emp_Id&&!!e.errors.Assigned_Emp_Id}),loading:g,filterOptions:(s,{inputValue:a})=>s.filter(b=>b.Employee.Employee_name.toLowerCase().includes(a.toLowerCase()))}),t(G,{children:e.touched.Assigned_Emp_Id&&e.errors.Assigned_Emp_Id?typeof e.errors.Assigned_Emp_Id=="string"?t("span",{children:e.errors.Assigned_Emp_Id}):Array.isArray(e.errors.Assigned_Emp_Id)?t("span",{children:e.errors.Assigned_Emp_Id.join(", ")}):null:null})]})]}),c(J,{children:[t(k,{onClick:i,color:"secondary",children:"Cancel"}),t(k,{type:"submit",color:"primary",children:"Add Task"})]})]})]})},je=z({Task_Details:x().required("Task Details are required"),createdAt:x().required("Created date is required"),Start_Date:$().required("Start Date is required"),End_Date:$().required("End Date is required"),Start_Time:x().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format").required("Start Time is required"),End_Time:x().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format").required("End Time is required"),Assigned_Emp_Id:R().required("Assigned employee is required")}).test("startDateTime","Start date and time cannot be earlier than the created date/time",function(r){const{Start_Date:i,Start_Time:o,createdAt:d}=r;if(console.log("Start_Date:",i),console.log("Start_Time:",o),console.log("createdAt:",d),i&&o&&d){const e=new Date(d),[m,T]=o.split(":"),g=new Date(i);if(g.setHours(Number(m),Number(T),0,0),console.log("createdAtDate:",e),console.log("startDateTime:",g),g<e)return console.log("Start date/time is earlier than createdAt."),this.createError({path:"Start_Date",message:"Start date/time is earlier than created date/time"})}return!0}).test("endDateTime","Start date/time cannot be after end date/time",function(r){const{Start_Date:i,Start_Time:o,End_Date:d,End_Time:e}=r;if(console.log("Start_Date:",i),console.log("Start_Time:",o),console.log("End_Date:",d),console.log("End_Time:",e),i&&o&&d&&e){const[m,T]=o.split(":"),[g,h]=e.split(":"),D=new Date(i),_=new Date(d);if(D.setHours(Number(m),Number(T),0,0),_.setHours(Number(g),Number(h),0,0),console.log("startDateTime:",D),console.log("endDateTime:",_),D>_)return console.log("Start date/time is after end date/time."),this.createError({path:"End_Time",message:"Start date/time is after end date/time"})}return!0}).test("endDateTimeCheck","End date/time cannot be earlier than start date/time",function(r){const{Start_Date:i,Start_Time:o,End_Date:d,End_Time:e}=r;if(console.log("Start_Date:",i),console.log("Start_Time:",o),console.log("End_Date:",d),console.log("End_Time:",e),i&&o&&d&&e){const[m,T]=o.split(":"),[g,h]=e.split(":"),D=new Date(i),_=new Date(d);if(D.setHours(Number(m),Number(T),0,0),_.setHours(Number(g),Number(h),0,0),console.log("startDateTime:",D),console.log("endDateTime:",_),_<D)return console.log("End date/time is earlier than start date/time."),this.createError({path:"End_Date",message:"End date/time is earlier than start date/time"})}return!0});function ze({open:r,onClose:i,task:o,fetchTasks:d,projectId:e}){const[m,T]=l.useState(!1),[g,h]=l.useState(""),[D,_]=l.useState([]);l.useEffect(()=>{h("")},[r]);const A=async p=>{T(!0),h("");try{await $e(p.Task_details_Id,p),d(),i()}catch(u){h("Error updating task"),console.error("Error updating task:",u)}finally{T(!1)}};function y(p){const u=new Date(p),C=`0${u.getMonth()+1}`.slice(-2),S=`0${u.getDate()}`.slice(-2);return`${u.getFullYear()}-${C}-${S}`}return l.useEffect(()=>{r&&(async()=>{try{const u=await Z(e);_(u)}catch(u){h("Failed to fetch project employees."),console.error("Error fetching employees:",u)}})()},[r,e]),c(K,{open:r,onClose:i,children:[t(Y,{children:"Edit Task"}),t(V,{children:t(Te,{initialValues:o,enableReinitialize:!0,validationSchema:je,onSubmit:A,validateOnChange:!0,validateOnBlur:!0,children:({values:p,handleChange:u,handleSubmit:C,handleBlur:S,touched:s,errors:a,setFieldValue:b})=>c(De,{children:[g&&t("p",{style:{color:"red"},children:g}),t(f,{fullWidth:!0,label:"Task Details",name:"Task_Details",value:p.Task_Details,onChange:u,margin:"dense",onBlur:S,error:s.Task_Details&&!!a.Task_Details,helperText:s.Task_Details&&typeof a.Task_Details=="string"?a.Task_Details:void 0}),t(f,{fullWidth:!0,label:"Start Date",type:"date",name:"Start_Date",value:y(p.Start_Date),onChange:u,onBlur:S,margin:"dense",InputLabelProps:{shrink:!0},error:s.Start_Date&&!!a.Start_Date,helperText:s.Start_Date&&typeof a.Start_Date=="string"?a.Start_Date:void 0}),t(f,{fullWidth:!0,label:"End Date",type:"date",name:"End_Date",value:y(p.End_Date),onChange:u,onBlur:S,margin:"dense",InputLabelProps:{shrink:!0},error:s.End_Date&&!!a.End_Date,helperText:s.End_Date&&typeof a.End_Date=="string"?a.End_Date:void 0}),t(f,{fullWidth:!0,label:"Start Time",type:"time",name:"Start_Time",value:p.Start_Time,onChange:u,onBlur:S,margin:"dense",InputLabelProps:{shrink:!0},error:s.Start_Time&&!!a.Start_Time,helperText:s.Start_Time&&typeof a.Start_Time=="string"?a.Start_Time:void 0}),t(f,{fullWidth:!0,label:"End Time",type:"time",name:"End_Time",value:p.End_Time,onChange:u,onBlur:S,margin:"dense",InputLabelProps:{shrink:!0},error:s.End_Time&&!!a.End_Time,helperText:s.End_Time&&typeof a.End_Time=="string"?a.End_Time:void 0}),c(U,{fullWidth:!0,margin:"dense",error:s.Assigned_Emp_Id&&!!a.Assigned_Emp_Id,children:[t(Se,{children:"Assigned Employee"}),t(Ee,{value:p.Assigned_Emp_Id||"",onChange:I=>b("Assigned_Emp_Id",I.target.value),label:"Assigned Employee",variant:"outlined",children:D.map(I=>t(fe,{value:I.Emp_Id,children:I.Employee.Employee_name},I.Emp_Id))}),t(G,{children:s.Assigned_Emp_Id&&a.Assigned_Emp_Id?typeof a.Assigned_Emp_Id=="string"?t("span",{children:a.Assigned_Emp_Id}):Array.isArray(a.Assigned_Emp_Id)?t("span",{children:a.Assigned_Emp_Id.join(", ")}):null:null}),"              "]}),c(J,{children:[t(k,{onClick:i,disabled:m,children:"Cancel"}),t(k,{type:"submit",variant:"contained",color:"primary",disabled:m,children:m?"Saving...":"Save"})]})]})})})]})}const E=Q(ye)(({theme:r})=>({[`&.${W.head}`]:{backgroundColor:"#f26729",color:"white",padding:"1em 8px"},[`&.${W.body}`]:{fontSize:12,padding:"4px 8px"}})),Re=Q(X)(({theme:r})=>({"&:nth-of-type(odd)":{backgroundColor:r.palette.action.hover},"&:last-child td, &:last-child th":{border:0}}));function Ke(){const[r,i]=l.useState([]),[o,d]=l.useState(null),[e,m]=l.useState(!1),[T,g]=l.useState(null),[h,D]=l.useState(null),[_,A]=l.useState(null),[y,p]=l.useState(null),[u,C]=l.useState(""),[S,s]=l.useState(""),[a,b]=l.useState(1),[I,ee]=l.useState(0),[w]=l.useState(5),v=l.useRef(null),[L,te]=l.useState(null),[ae,M]=l.useState(!1),{showWarningDialog:ne,DialogComponent:re}=He(),P=async()=>{try{const n=await Le(S,a,w,ne);i(n.tasks),ee(n.total),D(n.projectId),A(n.projectName)}catch{d("Failed to fetch tasks.")}};l.useEffect(()=>{P()},[S,a,w,100]);const se=()=>{console.log("Button clicked: Opening Add Task Form"),g(null),m(!0)},ie=()=>{console.log("Closing Add Task Form"),m(!1)},le=n=>{te(n),M(!0)},oe=()=>{M(!1)},de=n=>{n.target.files&&n.target.files[0]&&(p(n.target.files[0]),C(""))},ce=async()=>{if(y)try{const n=await Me(h,y);C(n.message),p(null),v.current&&(v.current.value=""),P()}catch(n){C(n.message)}else C("Please select a file to upload.")},me=()=>{v.current&&v.current.click()},ue=n=>{s(n.target.value),b(1)},N=n=>{b(n)},pe=n=>n?new Date(n).toISOString().split("T")[0]:"";return c(Ne,{children:[c(B,{sx:{width:"100%",paddingLeft:2,paddingRight:2,marginTop:1,overflow:"auto"},children:[t(Be,{}),t(B,{sx:{display:"flex",flexDirection:"column"},children:c(qe,{sx:{marginTop:"0 em"},children:[t(j,{variant:"h6",component:"div",sx:{flex:"1 1 1",color:"black",marginLeft:"1em"},children:_}),c(B,{sx:{marginTop:2},children:[t(k,{type:"button",style:{zIndex:"200"},onClick:se,children:"Add Task"}),t("input",{type:"file",accept:".xlsx, .xls",onChange:de,style:{display:"none"},ref:v}),t(k,{variant:"contained",style:{zIndex:"200"},color:"primary",onClick:me,children:"Select File"}),t(k,{variant:"contained",style:{zIndex:"200"},color:"secondary",onClick:ce,disabled:!y,sx:{marginLeft:2},children:"Upload Tasks"}),u&&t("p",{children:u})," "]}),t(f,{variant:"outlined",placeholder:"Search tasks...",value:S,size:"small",onChange:ue,sx:{zIndex:200}})]})}),c(B,{component:"main",sx:{flexGrow:1,bgcolor:"background.default",marginTop:"-4em",width:"100%"},children:[t(Pe,{}),t(ve,{component:be,children:c(Ie,{sx:{minWidth:700},"aria-label":"customized table",children:[t(ke,{children:c(X,{children:[t(E,{children:"S.No"}),t(E,{align:"center",children:"Employ name"}),t(E,{align:"center",children:"Start Date"}),t(E,{align:"center",children:"Start Time"}),t(E,{align:"center",children:"Task"}),t(E,{align:"center",children:"Status"}),t(E,{align:"center",children:"Actions"})]})}),t(Ce,{children:r==null?void 0:r.map((n,he)=>{var H;return c(Re,{children:[c(E,{component:"th",scope:"row",children:[he+1+(a-1)*w," "]}),t(E,{align:"center",children:(H=n==null?void 0:n.Employee)==null?void 0:H.Employee_name}),t(E,{align:"center",children:pe(n==null?void 0:n.Start_Date)}),t(E,{align:"center",children:n==null?void 0:n.Start_Time}),t(E,{align:"center",children:n==null?void 0:n.Task_Details}),t(E,{align:"center",children:n==null?void 0:n.Status}),t(E,{style:{textAlign:"center"},children:c(k,{children:[t(O,{title:"View Details",placement:"top",children:t(Ae,{style:{marginTop:"0.8em",marginRight:"0.8em"},to:`/org-dashboard/task-table/task-details/${n.Task_details_Id}`,children:t(xe,{})})}),t(O,{title:"Edit",placement:"top",children:t(we,{onClick:()=>le(n)})})]})})]},n.Task_details_Id)})})]})}),c(B,{sx:{display:"flex",justifyContent:"center",marginTop:2},children:[t(k,{onClick:()=>N(a-1),disabled:a===1,children:"Previous"}),c(j,{sx:{margin:"0 1em"},children:["Page ",a," of ",Math.ceil(I/w)]}),t(k,{onClick:()=>N(a+1),disabled:a*w>=I,children:"Next"})]}),t(Oe,{open:e,onClose:ie,fetchTasks:P,projectId:h}),L&&t(ze,{open:ae,onClose:oe,task:L,projectId:h,fetchTasks:P})]})]}),re]})}export{Ke as default};
