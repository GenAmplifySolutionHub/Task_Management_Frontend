import{n as Q,o as v,a9 as X,a5 as Z,m as ee,r,j as s,a as t,p as te,x as ae,q as _,t as ne,v as re,w as se,M as j,a6 as le,y as ie,d as p,z as oe,s as z,H as de,J as q,K as N,N as ce,B as y,T as L,P as ue,Q as me,U as he,V as pe,W as ge,X as Te,b as _e,Y as Se,aa as fe}from"./vendor-n5dB3UuQ.js";import{a as De}from"./styles-D1Udczlp.js";import{c as ye,g as Ee,a as be,i as Ie}from"./TaskRoutes-D4K3MoW3.js";import{D as xe}from"./dataRenderLayoutOrg-RpeEvjfy.js";import"./index-Dh4pOBYX.js";const B=()=>new Date().toTimeString().slice(0,5),C=()=>new Date().toISOString().split("T")[0],Ce=Q({Task_Details:v().required("Task Details are required"),Start_Date:X().required("Start Date is required").test("is-future-date","Start Date cannot be in the past",function(n){const o=new Date,d=new Date(o.getFullYear(),o.getMonth(),o.getDate());return n>=d}),Start_Time:v().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format").required("Start Time is required").test("is-future-time","You cannot select a past time",function(n){const{Start_Date:o}=this.parent,d=new Date,m=new Date(o);return m.setHours(parseInt(n.split(":")[0],10)),m.setMinutes(parseInt(n.split(":")[1],10)),m>=d}),Assigned_Emp_Id:Z().required("Assigned employe is required"),End_Time:v().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Invalid time format").required("End Time is required").test("is-end-time-valid","End Time must be after Start Time",function(n){const{Start_Date:o,Start_Time:d,End_Date:m}=this.parent,e=new Date(o),u=new Date(m),E=new Date(`${e.toISOString().split("T")[0]}T${d}:00`),b=new Date(`${u.toISOString().split("T")[0]}T${n}:00`);console.log("Start DateTime:",E),console.log("End DateTime:",b);const g=e.getFullYear()===u.getFullYear()&&e.getMonth()===u.getMonth()&&e.getDate()===u.getDate();if(console.log("Same Day:",g),g){const I=parseInt(d.split(":")[0],10),S=parseInt(d.split(":")[1],10),l=parseInt(n.split(":")[0],10),c=parseInt(n.split(":")[1],10),T=I*60+S;return l*60+c<=T?this.createError({path:"End_Time",message:"End Time must be after Start Time"}):!0}return u>e})}),ke=({open:n,onClose:o,projectId:d,fetchTasks:m})=>{const e=ee({initialValues:{Task_Details:"",Start_Date:C(),Start_Time:B(),End_Date:C(),End_Time:B(),Assigned_Emp_Id:null},validationSchema:Ce,onSubmit:async l=>{const c={Project_Id:d,Start_Date:l.Start_Date,Start_Time:l.Start_Time,Task_Details:l.Task_Details,End_Date:l.End_Date,End_Time:l.End_Time,Assigned_Emp_Id:l.Assigned_Emp_Id};try{const T=await ye(c);m(),o()}catch(T){console.error("Error creating task:",T)}}}),[u,E]=r.useState([]),[b,g]=r.useState(!0),[I,S]=r.useState(null);return r.useEffect(()=>{n&&(async()=>{try{const c=await Ee(d);E(c)}catch(c){S("Failed to fetch project employees."),console.error("Error fetching employees:",c)}finally{g(!1)}})()},[n,d]),s(oe,{open:n,onClose:o,children:[t(te,{children:"Add New Task"}),s("form",{onSubmit:e.handleSubmit,children:[s(ae,{children:[t(_,{autoFocus:!0,margin:"dense",label:"Task Details",type:"text",fullWidth:!0,variant:"outlined",name:"Task_Details",value:e.values.Task_Details,onChange:e.handleChange,onBlur:e.handleBlur,error:e.touched.Task_Details&&!!e.errors.Task_Details,helperText:e.touched.Task_Details&&e.errors.Task_Details}),t(_,{margin:"dense",label:"Start Date",type:"date",fullWidth:!0,variant:"outlined",name:"Start_Date",value:e.values.Start_Date,onChange:e.handleChange,onBlur:e.handleBlur,error:e.touched.Start_Date&&!!e.errors.Start_Date,helperText:e.touched.Start_Date&&e.errors.Start_Date,InputLabelProps:{shrink:!0},inputProps:{min:C()}}),t(_,{margin:"dense",label:"Start Time",type:"time",fullWidth:!0,variant:"outlined",name:"Start_Time",value:e.values.Start_Time,onChange:e.handleChange,onBlur:e.handleBlur,error:e.touched.Start_Time&&!!e.errors.Start_Time,helperText:e.touched.Start_Time&&e.errors.Start_Time,InputLabelProps:{shrink:!0},inputProps:{min:B()}}),t(_,{margin:"dense",label:"End Date",type:"date",fullWidth:!0,variant:"outlined",name:"End_Date",value:e.values.End_Date,onChange:e.handleChange,onBlur:e.handleBlur,error:e.touched.End_Date&&!!e.errors.End_Date,helperText:e.touched.End_Date&&e.errors.End_Date,InputLabelProps:{shrink:!0},inputProps:{min:C()}}),t(_,{margin:"dense",label:"End Time",type:"time",fullWidth:!0,variant:"outlined",name:"End_Time",value:e.values.End_Time,onChange:e.handleChange,onBlur:e.handleBlur,error:e.touched.End_Time&&!!e.errors.End_Time,helperText:e.touched.End_Time&&e.errors.End_Time,InputLabelProps:{shrink:!0}}),s(ne,{fullWidth:!0,margin:"dense",error:e.touched.Assigned_Emp_Id&&!!e.errors.Assigned_Emp_Id,children:[t(re,{id:"assigned-emp-id-label",children:"Assigned Employee"}),s(se,{labelId:"assigned-emp-id-label",name:"Assigned_Emp_Id",value:e.values.Assigned_Emp_Id||"",onChange:e.handleChange,onBlur:e.handleBlur,fullWidth:!0,label:"Assigned Employee",children:[t(j,{value:"",children:t("em",{children:"None"})}),u.map(l=>s(j,{value:l.Emp_Id,children:[l.Employee.Employee_name," "]},l.Emp_Id))]}),t(le,{children:e.touched.Assigned_Emp_Id&&e.errors.Assigned_Emp_Id?typeof e.errors.Assigned_Emp_Id=="string"?t("span",{children:e.errors.Assigned_Emp_Id}):Array.isArray(e.errors.Assigned_Emp_Id)?t("span",{children:e.errors.Assigned_Emp_Id.join(", ")}):null:null})]})]}),s(ie,{children:[t(p,{onClick:o,color:"secondary",children:"Cancel"}),t(p,{type:"submit",color:"primary",children:"Add Task"})]})]})]})},i=z(de)(({theme:n})=>({[`&.${q.head}`]:{backgroundColor:"#f26729",color:"white",padding:"1em 8px"},[`&.${q.body}`]:{fontSize:12,padding:"4px 8px"}})),we=z(N)(({theme:n})=>({"&:nth-of-type(odd)":{backgroundColor:n.palette.action.hover},"&:last-child td, &:last-child th":{border:0}}));function Me(){const[n,o]=r.useState([]),[d,m]=r.useState(null),[e,u]=r.useState(!1),[E,b]=r.useState(null),[g,I]=r.useState(null),[S,l]=r.useState(null),[c,T]=r.useState(null),[k,x]=r.useState(""),[w,O]=r.useState(""),[h,P]=r.useState(1),[F,W]=r.useState(0),[f]=r.useState(5),D=r.useRef(null),A=async()=>{try{const a=await be(w,h,f);o(a.tasks),W(a.total),I(a.projectId),l(a.projectName)}catch{m("Failed to fetch tasks.")}};r.useEffect(()=>{A()},[w,h,f]);const R=()=>{console.log("Button clicked: Opening Add Task Form"),b(null),u(!0)},H=()=>{console.log("Closing Add Task Form"),u(!1)},Y=a=>{a.target.files&&a.target.files[0]&&(T(a.target.files[0]),x(""))},U=async()=>{if(c)try{const a=await Ie(g,c);x(a.message),T(null),D.current&&(D.current.value=""),A()}catch(a){x(a.message)}else x("Please select a file to upload.")},V=()=>{D.current&&D.current.click()},G=a=>{O(a.target.value),P(1)},M=a=>{P(a)},J=a=>a?new Date(a).toISOString().split("T")[0]:"";return t(xe,{children:s(y,{sx:{width:"100%",paddingLeft:2,paddingRight:2,marginTop:1,overflow:"auto"},children:[t(ce,{}),t(y,{sx:{display:"flex",flexDirection:"column"},children:s(De,{sx:{marginTop:"0 em"},children:[t(L,{variant:"h6",component:"div",sx:{flex:"1 1 1",color:"black",marginLeft:"1em"},children:S}),s(y,{sx:{marginTop:2},children:[t(p,{type:"button",style:{zIndex:"200"},onClick:R,children:"Add Task"}),t("input",{type:"file",accept:".xlsx, .xls",onChange:Y,style:{display:"none"},ref:D}),t(p,{variant:"contained",style:{zIndex:"200"},color:"primary",onClick:V,children:"Select File"}),t(p,{variant:"contained",style:{zIndex:"200"},color:"secondary",onClick:U,disabled:!c,sx:{marginLeft:2},children:"Upload Tasks"}),k&&t("p",{children:k})," "]}),t(_,{variant:"outlined",placeholder:"Search tasks...",value:w,size:"small",onChange:G,sx:{zIndex:200}})]})}),s(y,{component:"main",sx:{flexGrow:1,bgcolor:"background.default",marginTop:"-4em",width:"100%"},children:[t(ue,{}),t(me,{component:he,children:s(pe,{sx:{minWidth:700},"aria-label":"customized table",children:[t(ge,{children:s(N,{children:[t(i,{children:"S.No"}),t(i,{align:"center",children:"Employ name"}),t(i,{align:"center",children:"Start Date"}),t(i,{align:"center",children:"Start Time"}),t(i,{align:"center",children:"Task"}),t(i,{align:"center",children:"Status"}),t(i,{align:"center",children:"Actions"})]})}),t(Te,{children:n==null?void 0:n.map((a,K)=>{var $;return s(we,{children:[s(i,{component:"th",scope:"row",children:[K+1+(h-1)*f," "]}),t(i,{align:"center",children:($=a==null?void 0:a.Employee)==null?void 0:$.Employee_name}),t(i,{align:"center",children:J(a==null?void 0:a.Start_Date)}),t(i,{align:"center",children:a==null?void 0:a.Start_Time}),t(i,{align:"center",children:a==null?void 0:a.Task_Details}),t(i,{align:"center",children:a==null?void 0:a.Status}),t(i,{style:{textAlign:"center"},children:t(_e,{title:"View Details",placement:"top",children:t(p,{children:t(Se,{style:{marginTop:"0.8em",marginRight:"0.8em"},to:`/org-dashboard/task-table/task-details/${a.Task_details_Id}`,children:t(fe,{})})})})})]},a.Task_details_Id)})})]})}),s(y,{sx:{display:"flex",justifyContent:"center",marginTop:2},children:[t(p,{onClick:()=>M(h-1),disabled:h===1,children:"Previous"}),s(L,{sx:{margin:"0 1em"},children:["Page ",h," of ",Math.ceil(F/f)]}),t(p,{onClick:()=>M(h+1),disabled:h*f>=F,children:"Next"})]}),t(ke,{open:e,onClose:H,fetchTasks:A,projectId:g})]})]})})}export{Me as default};
