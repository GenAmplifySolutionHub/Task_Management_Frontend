import{w as Y,x as R,ab as X,j as o,a as e,D as Z,a9 as V,r as u,ac as ee,G as w,z as te,A as ae,C as ne,M as A,a7 as re,y as C,af as ie,d as le,B as $,c as se,e as oe,ag as ce,s as z,H as de,J as O,K as j,f as y,Q as ue,U as me,V as he,W as Se,g as Te,I as ge,ah as pe,T as v,_ as _e,N as De,S as fe}from"./vendor-BtQO_-CK.js";import{a as be}from"./styles-sAMJ7xpl.js";import{e as xe,f as we}from"./TaskRoutes-BqEM3_Xu.js";import{D as ke}from"./dataRenderLayoutOrg--tDZst3Y.js";import{u as Ae}from"./index-Bf_oC5G5.js";function p(n){const s=new Date(n),m=`0${s.getMonth()+1}`.slice(-2),c=`0${s.getDate()}`.slice(-2);return`${s.getFullYear()}-${m}-${c}`}const ye=Y({Status:R().required("Status is required"),Remarks:R().nullable().test("is-overdue","Remarks is required when the task is overdue",function(n){const{End_Date:s,End_Time:m}=this.parent,c=`${p(s)}T${m}:00`;return!(new Date(c)<new Date)||n&&n.trim()!==""}),Actual_Start_Date:X().nullable().test("validate-actual-start-date","Invalid Actual Start Date",function(n){const{Start_Date:s,Start_Time:m,createdAt:c,Actual_Start_Time:h}=this.parent;if(n){const r=new Date(`${p(s)}T${m}:00`),d=new Date(c),S=h||new Date().toTimeString().slice(0,5),a=new Date(`${p(n)}T${S}:00`),i=new Date(a);if(i.setDate(i.getDate()),i>r)return this.createError({message:`Actual Start Date cannot be more than ${r}`});if(i<d)return this.createError({message:`Actual Start Date cannot be less than ${d}`})}return!0}),Actual_Start_Time:R().nullable().test("validate-actual-start-time","Actual Start Time should not be null if starting early",function(n){const{Start_Date:s,Start_Time:m}=this.parent,c=`${p(s)}T${m}:00`;return new Date(c)>new Date&&(!n||n.trim()==="")?this.createError({message:"Actual Start Time is required when starting early"}):!0})}),Ce=ce(()=>({dialog:{width:"400px",maxWidth:"100%"},inputField:{width:"100%",boxSizing:"border-box"}})),$e=({open:n,onClose:s,initialValues:m,onSubmit:c})=>{const h=Ce();return o(oe,{open:n,onClose:s,classes:{paper:h.dialog},children:[e(Z,{children:"Edit Task"}),e(se,{children:e(V,{initialValues:{...m,Remarks:m.Remarks||""},validationSchema:ye,onSubmit:(r,{setSubmitting:d})=>{const S={...r,Remarks:r.Remarks?r.Remarks.trim():""};c(S),d(!1)},children:({values:r,handleChange:d,handleBlur:S,errors:a,touched:i,isSubmitting:g,setFieldValue:_})=>{const b=`${p(r.End_Date)}T${r.End_Time}:00`,T=new Date(b)<new Date,k=`${p(r.Start_Date)}T${r.Start_Time}:00`,D=new Date(k)>new Date;return u.useEffect(()=>{(T||!T&&!D)&&(_("Actual_Start_Date",null),_("Actual_Start_Time",null))},[T,D,_]),console.log("is overdue",T),console.log("is start before",D),o(ee,{children:[o(w,{container:!0,spacing:2,children:[e(w,{item:!0,xs:12,children:o(te,{fullWidth:!0,variant:"outlined",margin:"dense",error:!!(i.Status&&a.Status),children:[e(ae,{children:"Status"}),o(ne,{name:"Status",value:r.Status,onChange:d,onBlur:S,label:"Status",className:h.inputField,children:[e(A,{value:"",children:e("em",{children:"None"})}),e(A,{value:"Pending",children:"Pending"}),e(A,{value:"In Progress",children:"In Progress"}),e(A,{value:"Completed",children:"Completed"})]}),i.Status&&a.Status&&e(re,{children:typeof a.Status=="string"?a.Status:""})]})}),T&&e(w,{item:!0,xs:12,children:e(C,{name:"Remarks",label:"Remarks",fullWidth:!0,variant:"outlined",margin:"dense",value:r.Remarks||"",onChange:d,onBlur:S,error:!!(i.Remarks&&a.Remarks),helperText:i.Remarks&&a.Remarks?String(a.Remarks):"",className:h.inputField})}),D&&o(ie,{children:[e(w,{item:!0,xs:12,children:e(C,{name:"Actual_Start_Date",label:"Actual Start Date",type:"date",variant:"outlined",margin:"dense",value:r.Actual_Start_Date?p(r.Actual_Start_Date):"",onChange:d,onBlur:S,error:!!(i.Actual_Start_Date&&a.Actual_Start_Date),helperText:i.Actual_Start_Date&&a.Actual_Start_Date?String(a.Actual_Start_Date):"",className:h.inputField,InputLabelProps:{shrink:!0}})}),e(w,{item:!0,xs:12,children:e(C,{name:"Actual_Start_Time",label:"Actual Start Time",type:"time",variant:"outlined",margin:"dense",value:r.Actual_Start_Time,onChange:d,onBlur:S,error:!!(i.Actual_Start_Time&&a.Actual_Start_Time),helperText:i.Actual_Start_Time&&a.Actual_Start_Time?String(a.Actual_Start_Time):"",className:h.inputField,InputLabelProps:{shrink:!0}})})]})]}),o(le,{children:[e($,{onClick:s,color:"primary",children:"Cancel"}),e($,{type:"submit",color:"primary",disabled:g,children:"Save"})]})]})}})})]})},l=z(de)(({theme:n})=>({[`&.${O.head}`]:{backgroundColor:"#f26729",color:"white",padding:"1em 8px"},[`&.${O.body}`]:{fontSize:12,padding:"6px 8px"}})),N=z(j)(({theme:n})=>({"&:nth-of-type(odd)":{backgroundColor:n.palette.action.hover},"&:last-child td, &:last-child th":{border:0}}));function Be(){const[n,s]=u.useState([]),[m,c]=u.useState(null),[h,r]=u.useState(!1),[d,S]=u.useState(null),[a,i]=u.useState(1),[g,_]=u.useState(5),[b,I]=u.useState(""),[T,k]=u.useState(0),[P,D]=u.useState(null),[W,B]=u.useState(!1),{showWarningDialog:F,DialogComponent:M}=Ae(),q=async()=>{try{const t=await xe(a,g,b,F);console.log("API Response:",t),t.tasks&&t.tasks.length>0?(s(t.tasks),k(t.total)):(s([]),k(0))}catch(t){c("Failed to fetch tasks."),console.error("Fetch error:",t)}};u.useEffect(()=>{q()},[a,g,b]);const H=t=>{S(t),r(!0)},L=()=>{r(!1),S(null)},G=async t=>{try{const f=await we(d.Task_details_Id,t.Status,t.Remarks,t.Actual_Start_Date,t.Actual_Start_Time,F);if(console.log("hello"),f.message==="Task updated successfully"){const x=f.task,Q=n.map(E=>E.Task_details_Id===x.Task_details_Id?{...E,...x}:E);s(Q),D("Task updated successfully."),B(!0),L()}}catch(f){console.error("Failed to update task:",f),c("Failed to update task.")}},U=t=>{I(t.target.value),i(1)},J=()=>{B(!1)},K=t=>t?new Date(t).toISOString().split("T")[0]:"";return o(ke,{children:[o(y,{sx:{width:"100%",paddingLeft:2,paddingRight:2,marginTop:1,overflow:"auto"},children:[e(De,{}),e(y,{sx:{display:"flex",flexDirection:"column",marginBottom:"4em"},children:o(be,{children:[e(v,{variant:"h6",component:"div",sx:{flex:"1 1 1",color:"black",marginLeft:"1em"},children:"Task List"}),e(C,{variant:"outlined",placeholder:"Search tasks...",value:b,size:"small",onChange:U,sx:{zIndex:200}})]})}),o(y,{component:"main",sx:{flexGrow:1,bgcolor:"background.default",marginTop:"-4em",width:"100%"},children:[e(_e,{component:ue,children:o(me,{sx:{minWidth:700},"aria-label":"customized table",children:[o(he,{sx:{backgroundColor:"black"},children:[" ",o(j,{children:[e(l,{sx:{color:"white"},children:"S.No"})," ",e(l,{align:"center",sx:{color:"white"},children:"Task"}),e(l,{align:"center",sx:{color:"white"},children:"Project"}),e(l,{align:"center",sx:{color:"white"},children:"Start Time"}),e(l,{align:"center",sx:{color:"white"},children:"End Date"}),e(l,{align:"center",sx:{color:"white"},children:"End Time"}),e(l,{align:"center",sx:{color:"white"},children:"Task Status"}),e(l,{align:"center",sx:{color:"white"},children:"Actions"})]})]}),e(Se,{children:n.length>0?n.map((t,f)=>{var x;return o(N,{children:[e(l,{component:"th",scope:"row",children:f+1+(a-1)*g}),e(l,{align:"center",children:t==null?void 0:t.Task_Details}),e(l,{align:"center",children:(x=t==null?void 0:t.Project)==null?void 0:x.Project_Name}),e(l,{align:"center",children:t==null?void 0:t.Start_Time}),e(l,{align:"center",children:K(t==null?void 0:t.End_Date)}),e(l,{align:"center",children:t==null?void 0:t.End_Time}),e(l,{align:"center",children:t==null?void 0:t.Status}),e(l,{align:"center",children:t.Status!=="Completed"&&e(Te,{title:"Update status",placement:"top",children:e(ge,{sx:{zIndex:20,backgroundColor:"rgba(255, 255, 255, 0.5)"},onClick:()=>H(t),children:e(pe,{sx:{color:"blue"}})})})})]},t.Task_details_Id)}):e(N,{children:e(l,{colSpan:7,align:"center",children:e(v,{variant:"body1",children:"No tasks found."})})})})]})}),e(y,{sx:{display:"flex",justifyContent:"center",marginTop:2},children:o(v,{variant:"body2",component:"div",children:[e($,{disabled:a===1,onClick:()=>i(a-1),children:"Previous"}),"Page ",a," of ",Math.ceil(T/g)," | Total Tasks: ",T,e($,{disabled:n.length<g,onClick:()=>i(a+1),children:"Next"})]})})]}),e($e,{open:h,onClose:L,initialValues:d||{},onSubmit:G}),e(fe,{open:W,autoHideDuration:6e3,onClose:J,message:P})]}),M]})}export{Be as default};
