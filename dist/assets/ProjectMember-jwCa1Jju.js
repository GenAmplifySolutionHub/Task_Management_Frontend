import{l as re,v as ue,w as ne,a5 as V,x as O,r as o,a as e,j as d,G as h,a6 as ae,y as k,z as W,M as j,a7 as ee,B as w,f as $,D as J,d as K,g as Q,I as U,a8 as ge,c as Y,e as Z,a9 as pe,C as Ee,s as oe,H as fe,J as te,K as le,_ as _e,Q as Ie,U as De,V as be,W as Se,Y as ye,Z as Ce,aa as xe,b as Re}from"./vendor-BtQO_-CK.js";import{S as Te}from"./styles-sAMJ7xpl.js";import{u as X,a as Pe,g as G,p as ve,D as Fe,b as Ae,d as Be}from"./index-Bf_oC5G5.js";const je=g=>{const{fetchEmployees:p,onClose:s}=g,{id:R}=re(),{showWarningDialog:b,DialogComponent:S}=X(),n=ue({initialValues:{Emp_Id:null,Role_Id:null,Degesination:""},validationSchema:ne({Emp_Id:V().required("Employee is required"),Role_Id:V().required("Role is required"),Degesination:O().required("Designation is required")}),onSubmit:async r=>{try{const{Emp_Id:t,Role_Id:l,Degesination:m}=r,i=await Pe(b,Number(R),Number(t),Number(l),m);console.log(i),i&&i.success?(console.log("Success:",i.message),p(),s()):n.setFieldError("Emp_Id",i.message||"Unexpected response format. Please try again.")}catch(t){if(console.error("Complete Error Object:",t),t.status===409){if(t.data&&t.data.message){const l=t.data.message;l.includes("A team lead for the designation")?n.setFieldError("Role_Id",l):l.includes("Employee is already assigned to this project.")?n.setFieldError("Emp_Id",l):n.setFieldError("Emp_Id",l||"An error occurred.")}}else t.data&&t.data.message?n.setFieldError("Emp_Id",t.data.message||"An error occurred."):n.setFieldError("Emp_Id","An unexpected error occurred. Please try again.")}}}),[q,y]=o.useState([]),[I,x]=o.useState(["Developer","Tester","DB","Devops","BA"]),[_,D]=o.useState(!0),[C,T]=o.useState(null),[P,v]=o.useState(1),[F,M]=o.useState(!0),[A,B]=o.useState("");o.useEffect(()=>{(async()=>{D(!0),T(null);try{const t=await G(b,P,A);y(l=>[...l,...t.data]),M(t.data.length>0)}catch(t){T(t.message)}finally{D(!1)}})()},[P,A]);const N=r=>{r.currentTarget.scrollHeight===r.currentTarget.scrollTop+r.currentTarget.clientHeight&&F&&!_&&v(l=>l+1)};return e($,{component:"form",onSubmit:n.handleSubmit,sx:{display:"flex",flexDirection:"column",gap:2,width:"30em"},children:d(h,{container:!0,xs:12,spacing:2,children:[e(h,{item:!0,xs:12,sm:6,children:e(ae,{options:q,getOptionLabel:r=>r.Employee_name,onChange:(r,t)=>{n.setFieldValue("Emp_Id",t?t.Emp_Id:null)},onBlur:r=>{n.handleBlur(r),n.setFieldTouched("Emp_Id",!0)},onInputChange:(r,t)=>{B(t),y([]),v(1)},renderInput:r=>e(k,{...r,label:"Select Employee",variant:"outlined",error:n.touched.Emp_Id&&!!n.errors.Emp_Id,helperText:n.touched.Emp_Id&&n.errors.Emp_Id}),loading:_,noOptionsText:_?"Loading...":"No options",ListboxProps:{onScroll:N}})}),e(h,{item:!0,xs:12,sm:6,children:d(W,{fullWidth:!0,size:"small",children:[d(k,{select:!0,label:"Role",id:"Role_Id",name:"Role_Id",value:n.values.Role_Id||"",onChange:n.handleChange,onBlur:n.handleBlur,error:n.touched.Role_Id&&!!n.errors.Role_Id,children:[e(j,{value:2,children:"Team Lead"}),e(j,{value:3,children:"Member"})]}),e(ee,{error:n.touched.Role_Id&&!!n.errors.Role_Id,children:n.touched.Role_Id&&n.errors.Role_Id})]})}),e(h,{item:!0,xs:12,children:d(W,{fullWidth:!0,size:"small",children:[e(k,{select:!0,label:"Designation",id:"Degesination",name:"Degesination",value:n.values.Degesination||"",onChange:n.handleChange,onBlur:n.handleBlur,error:n.touched.Degesination&&!!n.errors.Degesination,children:I.map((r,t)=>e(j,{value:r,children:r},t))}),n.touched.Degesination&&n.errors.Degesination&&e(ee,{error:!0,children:n.errors.Degesination})]})}),e(h,{item:!0,xs:12,children:e(w,{color:"primary",variant:"contained",type:"submit",children:"Register"})}),S]})})},we=({open:g,onClose:p,fetchEmployees:s})=>d(Z,{open:g,onClose:p,children:[d(h,{xs:12,container:!0,spacing:2,paddingTop:2,justifyContent:"space-between",sx:{display:"flex"},children:[e(h,{children:e(J,{sx:{paddingLeft:"40px",color:"primary.main",fontWeight:"bold",fontSize:"1.5em"},children:"Add New Member"})}),e(h,{children:e(K,{children:e(Q,{title:"Close",sx:{color:"red"},children:e(U,{children:e(ge,{onClick:()=>p(!1),sx:{fontSize:"1.4em"}})})})})})]}),e(Y,{children:e(je,{fetchEmployees:s,onClose:p})})]}),Me=({open:g,onClose:p,employee:s})=>{const[R,b]=o.useState([]),[S,n]=o.useState(1),[q,y]=o.useState(!0),[I,x]=o.useState(""),[_,D]=o.useState(!1),{showWarningDialog:C,DialogComponent:T}=X(),[P]=o.useState(["Developer","Tester","DB","Devops","BA"]),v={ProjectMember_Id:s==null?void 0:s.ProjectMember_Id,Emp_Id:(s==null?void 0:s.Emp_Id)||"",Employee_name:(s==null?void 0:s.Employee_name)||"",Role_Id:(s==null?void 0:s.Role_Id)||"",Degesination:(s==null?void 0:s.Degesination)||""},F=ne().shape({Emp_Id:O().required("Employee is required"),Role_Id:O().required("Role is required"),Degesination:O().required("Designation is required")}),M=async(r,t)=>{try{(await ve(C,s.Project_Id,r.ProjectMember_Id,{Emp_Id:r.Emp_Id,Role_Id:r.Role_Id,Degesination:r.Degesination})).success&&p(!0)}catch(l){if(console.log("Complete Error Object:",l),t.setSubmitting(!1),l.message){const m=l.message;m.includes("A team lead with the designation")?t.setFieldError("Role_Id",m):m.includes("Employee is already assigned to this project.")?t.setFieldError("Emp_Id",m):t.setFieldError("Emp_Id",m||"An error occurred.")}else if(l.response){const{status:m,data:i}=l.response;if(m===409){if(i&&i.message){const E=i.message;E.includes("A team lead for the designation")?t.setFieldError("Role_Id",E):E.includes("Employee is already assigned to this project.")?t.setFieldError("Emp_Id",E):t.setFieldError("Emp_Id",E||"An error occurred.")}}else i&&i.message?t.setFieldError("Emp_Id",i.message||"An error occurred."):t.setFieldError("Emp_Id","An unexpected error occurred. Please try again.")}else t.setFieldError("Emp_Id","Network error. Please try again.")}},A=async()=>{D(!0);try{const r=await G(C,S,I);b(t=>S===1?r.data:[...t,...r.data]),y(r.data.length>0)}finally{D(!1)}},B=async()=>{D(!0);try{const r=await G(C,S,s==null?void 0:s.Employee_name);b(t=>S===1?r.data:[...t,...r.data]),y(r.data.length>0)}finally{D(!1)}};o.useEffect(()=>{g&&B()},[g]),o.useEffect(()=>{A()},[S,I]);const N=r=>{r.currentTarget.scrollHeight===r.currentTarget.scrollTop+r.currentTarget.clientHeight&&q&&!_&&n(l=>l+1)};return d(Z,{open:g,onClose:()=>p(!1),PaperProps:{style:{width:"30em"}},children:[e(J,{children:"Edit Member"}),e(Y,{children:e(pe,{initialValues:v,validationSchema:F,onSubmit:M,enableReinitialize:!0,children:({values:r,handleChange:t,handleBlur:l,handleSubmit:m,errors:i,touched:E,setFieldValue:L})=>d("form",{onSubmit:m,children:[d(h,{container:!0,spacing:2,children:[e(h,{item:!0,xs:12,sm:6,children:e(ae,{options:R,value:R.find(c=>c.Emp_Id===r.Emp_Id)||null,getOptionLabel:c=>c.Employee_name,onInputChange:(c,f)=>{x(f),n(1),f===""&&x("")},onChange:(c,f)=>{L("Emp_Id",(f==null?void 0:f.Emp_Id)||""),L("Employee_name",(f==null?void 0:f.Employee_name)||"")},renderInput:c=>e(k,{...c,label:"Employee Name",variant:"outlined",error:E.Emp_Id&&!!i.Emp_Id,helperText:E.Emp_Id&&i.Emp_Id?String(i.Emp_Id):"",onBlur:l}),ListboxProps:{onScroll:N},isOptionEqualToValue:(c,f)=>c.Emp_Id===f.Emp_Id})}),e(h,{item:!0,xs:12,sm:6,children:e(W,{fullWidth:!0,children:d(k,{select:!0,label:"Role",id:"Role_Id",name:"Role_Id",value:r.Role_Id,onChange:t,onBlur:l,error:E.Role_Id&&!!i.Role_Id,helperText:E.Role_Id&&i.Role_Id?String(i.Role_Id):"",children:[e(j,{value:2,children:"Team Lead"}),e(j,{value:3,children:"Member"})]})})}),e(h,{item:!0,xs:12,children:e(W,{fullWidth:!0,children:e(Ee,{label:"Designation",id:"Degesination",name:"Degesination",value:r.Degesination,onChange:t,onBlur:l,error:E.Degesination&&!!i.Degesination,children:P.map(c=>e(j,{value:c,children:c},c))})})})]}),d(K,{children:[e(w,{onClick:()=>p(!1),color:"secondary",children:"Cancel"}),e(w,{type:"submit",color:"primary",children:"Save"})]})]})})}),T]})},u=oe(fe)(({theme:g})=>({[`&.${te.head}`]:{backgroundColor:"#f26729",color:"white",padding:"1em 8px"},[`&.${te.body}`]:{fontSize:12,padding:"6px 8px"}})),Ne=oe(le)(({theme:g})=>({"&:nth-of-type(odd)":{backgroundColor:g.palette.action.hover},"&:last-child td, &:last-child th":{border:0}})),Oe=()=>{const{id:g}=re(),[p,s]=o.useState([]),[R,b]=o.useState(!1),[S,n]=o.useState(!0),[q,y]=o.useState(null),[I,x]=o.useState(0),[_,D]=o.useState(5),[C,T]=o.useState(""),[P,v]=o.useState(0),{showWarningDialog:F,DialogComponent:M}=X(),[A,B]=o.useState(!1),[N,r]=o.useState(null),[t,l]=o.useState(!1),[m,i]=o.useState(null),E=()=>{b(!0)},L=(a=!1)=>{b(!1)},c=async()=>{n(!0),y(null);try{const a=await Ae(Number(g),I+1,_,C,F);s(a.data),v(a.total)}catch(a){y(a.message)}finally{n(!1)}};o.useEffect(()=>{c()},[g,I,_,C]);const f=(a,H)=>{x(H)},se=a=>{D(parseInt(a.target.value,10)),x(0)},ie=a=>{T(a.target.value),x(0)},de=a=>{r(a),B(!0)},ce=(a=!1)=>{B(!1),r(null),a&&c()},he=a=>{i(a),l(!0)},z=()=>{i(null),l(!1)},me=async()=>{if(m)try{await Be(F,m.Project_Id,m.Emp_Id),z(),c()}catch(a){console.error("Failed to delete employee:",a)}};return e(Fe,{children:d($,{sx:{width:"auto",overflow:"auto",paddingLeft:2,paddingRight:2},children:[e(h,{container:!0,spacing:2,children:e(h,{item:!0,xs:12,padding:2,sx:{marginTop:"1.4em"},children:d($,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e(h,{children:e(Te,{value:C,onChange:ie,placeholder:"Search by Employee Name",size:"small"})}),e(h,{children:e(w,{variant:"contained",color:"primary",onClick:E,children:"Add New Member"})}),e(we,{open:R,onClose:a=>L(a),fetchEmployees:c})]})})}),e(_e,{component:Ie,children:d(De,{sx:{minWidth:700},"aria-label":"customized table",children:[e(be,{children:d(le,{children:[e(u,{children:"S.No"}),e(u,{align:"center",children:"Emp Id"}),e(u,{align:"center",children:"Project Name"}),e(u,{align:"center",children:"Employee Name"}),e(u,{align:"center",children:"Role"}),e(u,{align:"center",children:"Designation"}),e(u,{align:"center",children:"Actions"})]})}),e(Se,{children:p==null?void 0:p.map((a,H)=>d(Ne,{children:[e(u,{component:"th",scope:"row",children:I*_+H+1}),e(u,{align:"center",children:a.Emp_Id}),e(u,{align:"center",children:a.Project_Name}),e(u,{align:"center",children:a.Employee_name}),e(u,{align:"center",children:a.Role_Name}),e(u,{align:"center",children:a.Degesination}),d(u,{align:"center",children:[e(Q,{title:"Edit",placement:"top",children:e(U,{onClick:()=>de(a),children:e(ye,{color:"blue"})})}),e(Q,{title:"Delete",placement:"top",children:e(U,{onClick:()=>he(a),children:e(Ce,{color:"red"})})})]})]},a.Emp_Id))})]})}),e(xe,{component:"div",count:P,page:I,onPageChange:f,rowsPerPage:_,onRowsPerPageChange:se}),M,e(Me,{open:A,onClose:ce,employee:N}),d(Z,{open:t,onClose:z,children:[e(J,{children:"Confirm Deletion"}),e(Y,{children:e(Re,{children:"Are you sure you want to delete this employee?"})}),d(K,{children:[e(w,{onClick:z,color:"primary",children:"Cancel"}),e(w,{onClick:me,color:"secondary",autoFocus:!0,children:"Delete"})]})]})]})})};export{Oe as default};
