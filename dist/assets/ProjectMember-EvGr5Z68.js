import{f as M,m as O,n as H,a5 as F,o as Q,r as t,a as e,j as s,G as i,t as S,v as C,w as R,M as E,a6 as v,d as z,B as w,p as U,y as G,b as P,c as B,a7 as V,x as J,z as K,s as L,H as X,J as N,K as k,Q as Z,U as Y,V as ee,W as ae,X as re,Z as le,_ as ne,a8 as te}from"./vendor-n5dB3UuQ.js";import{S as oe}from"./styles-D1Udczlp.js";import{a as se,g as ie,D as de,b as ce}from"./index-Dh4pOBYX.js";const he=d=>{const{fetchEmployees:c,onClose:f}=d,{id:I}=M(),a=O({initialValues:{Emp_Id:null,Role_Id:null,Degesination:""},validationSchema:H({Emp_Id:F().required("Employee is required"),Role_Id:F().required("Role is required"),Degesination:Q().required("Designation is required")}),onSubmit:async o=>{try{const{Emp_Id:l,Role_Id:h,Degesination:x}=o,m=await se(Number(I),Number(l),Number(h),x);console.log(m),m&&m.success?(console.log("Success:",m.message),c(),f()):a.setFieldError("Emp_Id",m.message||"Unexpected response format. Please try again.")}catch(l){if(console.error("Complete Error Object:",l),l.status===409){if(l.data&&l.data.message){const h=l.data.message;h.includes("A team lead for the designation")?a.setFieldError("Role_Id",h):h.includes("Employee is already assigned to this project.")?a.setFieldError("Emp_Id",h):a.setFieldError("Emp_Id",h||"An error occurred.")}}else l.data&&l.data.message?a.setFieldError("Emp_Id",l.data.message||"An error occurred."):a.setFieldError("Emp_Id","An unexpected error occurred. Please try again.")}}}),[T,b]=t.useState([]),[A,_]=t.useState(["Developer","Tester","DB","Devops","BA"]),[u,g]=t.useState(!0),[p,y]=t.useState(null);return t.useEffect(()=>{(async()=>{g(!0),y(null);try{const l=await ie();b(l.data)}catch(l){y(l.message)}finally{g(!1)}})()},[]),e(w,{component:"form",onSubmit:a.handleSubmit,sx:{display:"flex",flexDirection:"column",gap:2,width:"30em"},children:s(i,{container:!0,xs:12,spacing:2,children:[e(i,{item:!0,xs:12,sm:6,children:s(S,{fullWidth:!0,size:"small",children:[e(C,{id:"employee-select-label",children:"Select Employee"}),e(R,{labelId:"employee-select-label",id:"Emp_Id",name:"Emp_Id",value:a.values.Emp_Id||"",onChange:a.handleChange,onBlur:a.handleBlur,error:a.touched.Emp_Id&&!!a.errors.Emp_Id,children:u?e(E,{disabled:!0,children:"Loading employees..."}):p?e(E,{disabled:!0,children:"Error fetching employees"}):T.map(o=>e(E,{value:o.Emp_Id,children:o.Employee_name},o.Emp_Id))}),a.touched.Emp_Id&&a.errors.Emp_Id&&e(v,{error:!0,children:a.errors.Emp_Id})]})}),e(i,{item:!0,xs:12,sm:6,children:s(S,{fullWidth:!0,size:"small",children:[e(C,{id:"role-select-label",children:"Role"}),s(R,{labelId:"role-select-label",id:"Role_Id",name:"Role_Id",value:a.values.Role_Id||"",onChange:a.handleChange,onBlur:a.handleBlur,error:a.touched.Role_Id&&!!a.errors.Role_Id,children:[e(E,{value:2,children:"Team Lead"})," ",e(E,{value:3,children:"Member"})," "]}),e(v,{error:a.touched.Role_Id&&!!a.errors.Role_Id,children:a.touched.Role_Id&&a.errors.Role_Id})]})}),e(i,{item:!0,xs:12,children:s(S,{fullWidth:!0,size:"small",children:[e(C,{id:"designation-select-label",children:"Designation"}),e(R,{labelId:"designation-select-label",id:"Degesination",name:"Degesination",value:a.values.Degesination||"",onChange:a.handleChange,onBlur:a.handleBlur,error:a.touched.Degesination&&!!a.errors.Degesination,children:A.map((o,l)=>e(E,{value:o,children:o},l))}),a.touched.Degesination&&a.errors.Degesination&&e(v,{error:!0,children:a.errors.Degesination})]})}),e(i,{item:!0,xs:12,children:e(z,{color:"primary",variant:"contained",type:"submit",children:"Register"})})]})})},me=({open:d,onClose:c,fetchEmployees:f})=>s(K,{open:d,onClose:c,children:[s(i,{xs:12,container:!0,spacing:2,paddingTop:2,justifyContent:"space-between",sx:{display:"flex"},children:[e(i,{children:e(U,{sx:{paddingLeft:"40px",color:"primary.main",fontWeight:"bold",fontSize:"1.5em"},children:"Add New Member"})}),e(i,{children:e(G,{children:e(P,{title:"Close",sx:{color:"red"},children:e(B,{children:e(V,{onClick:()=>c(!1),sx:{fontSize:"1.4em"}})})})})})]}),e(J,{children:e(he,{fetchEmployees:f,onClose:c})})]}),n=L(X)(({theme:d})=>({[`&.${N.head}`]:{backgroundColor:"#f26729",color:"white",padding:"1em 8px"},[`&.${N.body}`]:{fontSize:12,padding:"6px 8px"}})),ue=L(k)(({theme:d})=>({"&:nth-of-type(odd)":{backgroundColor:d.palette.action.hover},"&:last-child td, &:last-child th":{border:0}})),be=()=>{const{id:d}=M(),[c,f]=t.useState([]),[I,a]=t.useState(!1),[T,b]=t.useState(!0),[A,_]=t.useState(null),[u,g]=t.useState(0),[p,y]=t.useState(5),[o,l]=t.useState(""),[h,x]=t.useState(0),m=()=>{a(!0)},q=(r=!1)=>{a(!1)},j=async()=>{b(!0),_(null);try{const r=await ce(Number(d),u+1,p,o);f(r.data),x(r.total)}catch(r){_(r.message)}finally{b(!1)}};t.useEffect(()=>{j()},[d,u,p,o]);const W=(r,D)=>{g(D)},$=r=>{y(parseInt(r.target.value,10)),g(0)};return e(de,{children:s(w,{sx:{width:"auto",overflow:"auto",paddingLeft:2,paddingRight:2},children:[e(i,{container:!0,spacing:2,children:e(i,{item:!0,xs:12,padding:2,sx:{marginTop:"1.4em"},children:s(w,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e(i,{children:e(oe,{value:o,onChange:r=>{l(r.target.value),g(0)},placeholder:"Search by Employee Name",size:"small"})}),e(i,{children:e(z,{variant:"contained",color:"primary",onClick:m,children:"Add New Member"})}),e(me,{open:I,onClose:r=>q(r),fetchEmployees:j})]})})}),e(Z,{component:Y,children:s(ee,{sx:{minWidth:700},"aria-label":"customized table",children:[e(ae,{children:s(k,{children:[e(n,{children:"S.No"}),e(n,{align:"center",children:"Emp Id"}),e(n,{align:"center",children:"Project Name"}),e(n,{align:"center",children:"Employee Name"}),e(n,{align:"center",children:"Role"}),e(n,{align:"center",children:"Designation"}),e(n,{align:"center",children:"Actions"})]})}),e(re,{children:c==null?void 0:c.map((r,D)=>s(ue,{children:[e(n,{component:"th",scope:"row",children:u*p+D+1}),e(n,{align:"center",children:r.Emp_Id}),e(n,{align:"center",children:r.Project_Name}),e(n,{align:"center",children:r.Employee_name}),e(n,{align:"center",children:r.Role_Name}),e(n,{align:"center",children:r.Degesination}),s(n,{align:"center",children:[e(P,{title:"Edit",placement:"top",children:e(B,{children:e(le,{color:"blue"})})}),e(P,{title:"Delete",placement:"top",children:e(B,{children:e(ne,{color:"red"})})})]})]},r.Emp_Id))})]})}),e(te,{component:"div",count:h,page:u,onPageChange:W,rowsPerPage:p,onRowsPerPageChange:$})]})})};export{be as default};
