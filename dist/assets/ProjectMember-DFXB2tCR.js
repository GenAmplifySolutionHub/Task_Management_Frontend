import{l as k,v as W,w as $,a5 as j,x as Q,r as o,a as e,j as i,G as d,a6 as U,y as P,z as M,M as w,a7 as L,B as q,f as v,D as V,d as G,g as A,I as B,a8 as J,c as K,e as X,s as H,H as Z,J as z,K as O,Q as Y,U as ee,V as te,W as ae,X as re,Z as ne,_ as oe,a9 as le}from"./vendor-s1X2VnKx.js";import{S as se}from"./styles-B0qleVj-.js";import{a as ie,g as de,D as ce,b as he}from"./index-CBGQAfrx.js";const ue=c=>{const{fetchEmployees:h,onClose:f}=c,{id:_}=k(),t=W({initialValues:{Emp_Id:null,Role_Id:null,Degesination:""},validationSchema:$({Emp_Id:j().required("Employee is required"),Role_Id:j().required("Role is required"),Degesination:Q().required("Designation is required")}),onSubmit:async n=>{try{const{Emp_Id:a,Role_Id:s,Degesination:r}=n,u=await ie(Number(_),Number(a),Number(s),r);console.log(u),u&&u.success?(console.log("Success:",u.message),h(),f()):t.setFieldError("Emp_Id",u.message||"Unexpected response format. Please try again.")}catch(a){if(console.error("Complete Error Object:",a),a.status===409){if(a.data&&a.data.message){const s=a.data.message;s.includes("A team lead for the designation")?t.setFieldError("Role_Id",s):s.includes("Employee is already assigned to this project.")?t.setFieldError("Emp_Id",s):t.setFieldError("Emp_Id",s||"An error occurred.")}}else a.data&&a.data.message?t.setFieldError("Emp_Id",a.data.message||"An error occurred."):t.setFieldError("Emp_Id","An unexpected error occurred. Please try again.")}}}),[F,E]=o.useState([]),[N,D]=o.useState(["Developer","Tester","DB","Devops","BA"]),[m,g]=o.useState(!0),[b,y]=o.useState(null),[p,I]=o.useState(1),[C,R]=o.useState(!0),[x,T]=o.useState("");o.useEffect(()=>{(async()=>{g(!0),y(null);try{const a=await de(p,x);E(s=>[...s,...a.data]),R(a.data.length>0)}catch(a){y(a.message)}finally{g(!1)}})()},[p,x]);const S=n=>{n.currentTarget.scrollHeight===n.currentTarget.scrollTop+n.currentTarget.clientHeight&&C&&!m&&I(s=>s+1)};return e(v,{component:"form",onSubmit:t.handleSubmit,sx:{display:"flex",flexDirection:"column",gap:2,width:"30em"},children:i(d,{container:!0,xs:12,spacing:2,children:[e(d,{item:!0,xs:12,sm:6,children:e(U,{options:F,getOptionLabel:n=>n.Employee_name,onChange:(n,a)=>{t.setFieldValue("Emp_Id",a?a.Emp_Id:null)},onBlur:n=>{t.handleBlur(n),t.setFieldTouched("Emp_Id",!0)},onInputChange:(n,a)=>{T(a),E([]),I(1)},renderInput:n=>e(P,{...n,label:"Select Employee",variant:"outlined",error:t.touched.Emp_Id&&!!t.errors.Emp_Id,helperText:t.touched.Emp_Id&&t.errors.Emp_Id}),loading:m,noOptionsText:m?"Loading...":"No options",ListboxProps:{onScroll:S}})}),e(d,{item:!0,xs:12,sm:6,children:i(M,{fullWidth:!0,size:"small",children:[i(P,{select:!0,label:"Role",id:"Role_Id",name:"Role_Id",value:t.values.Role_Id||"",onChange:t.handleChange,onBlur:t.handleBlur,error:t.touched.Role_Id&&!!t.errors.Role_Id,children:[e(w,{value:2,children:"Team Lead"}),e(w,{value:3,children:"Member"})]}),e(L,{error:t.touched.Role_Id&&!!t.errors.Role_Id,children:t.touched.Role_Id&&t.errors.Role_Id})]})}),e(d,{item:!0,xs:12,children:i(M,{fullWidth:!0,size:"small",children:[e(P,{select:!0,label:"Designation",id:"Degesination",name:"Degesination",value:t.values.Degesination||"",onChange:t.handleChange,onBlur:t.handleBlur,error:t.touched.Degesination&&!!t.errors.Degesination,children:N.map((n,a)=>e(w,{value:n,children:n},a))}),t.touched.Degesination&&t.errors.Degesination&&e(L,{error:!0,children:t.errors.Degesination})]})}),e(d,{item:!0,xs:12,children:e(q,{color:"primary",variant:"contained",type:"submit",children:"Register"})})]})})},me=({open:c,onClose:h,fetchEmployees:f})=>i(X,{open:c,onClose:h,children:[i(d,{xs:12,container:!0,spacing:2,paddingTop:2,justifyContent:"space-between",sx:{display:"flex"},children:[e(d,{children:e(V,{sx:{paddingLeft:"40px",color:"primary.main",fontWeight:"bold",fontSize:"1.5em"},children:"Add New Member"})}),e(d,{children:e(G,{children:e(A,{title:"Close",sx:{color:"red"},children:e(B,{children:e(J,{onClick:()=>h(!1),sx:{fontSize:"1.4em"}})})})})})]}),e(K,{children:e(ue,{fetchEmployees:f,onClose:h})})]}),l=H(Z)(({theme:c})=>({[`&.${z.head}`]:{backgroundColor:"#f26729",color:"white",padding:"1em 8px"},[`&.${z.body}`]:{fontSize:12,padding:"6px 8px"}})),ge=H(O)(({theme:c})=>({"&:nth-of-type(odd)":{backgroundColor:c.palette.action.hover},"&:last-child td, &:last-child th":{border:0}})),be=()=>{const{id:c}=k(),[h,f]=o.useState([]),[_,t]=o.useState(!1),[F,E]=o.useState(!0),[N,D]=o.useState(null),[m,g]=o.useState(0),[b,y]=o.useState(5),[p,I]=o.useState(""),[C,R]=o.useState(0),x=()=>{t(!0)},T=(r=!1)=>{t(!1)},S=async()=>{E(!0),D(null);try{const r=await he(Number(c),m+1,b,p);f(r.data),R(r.total)}catch(r){D(r.message)}finally{E(!1)}};o.useEffect(()=>{S()},[c,m,b,p]);const n=(r,u)=>{g(u)},a=r=>{y(parseInt(r.target.value,10)),g(0)};return e(ce,{children:i(v,{sx:{width:"auto",overflow:"auto",paddingLeft:2,paddingRight:2},children:[e(d,{container:!0,spacing:2,children:e(d,{item:!0,xs:12,padding:2,sx:{marginTop:"1.4em"},children:i(v,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e(d,{children:e(se,{value:p,onChange:r=>{I(r.target.value),g(0)},placeholder:"Search by Employee Name",size:"small"})}),e(d,{children:e(q,{variant:"contained",color:"primary",onClick:x,children:"Add New Member"})}),e(me,{open:_,onClose:r=>T(r),fetchEmployees:S})]})})}),e(Y,{component:ee,children:i(te,{sx:{minWidth:700},"aria-label":"customized table",children:[e(ae,{children:i(O,{children:[e(l,{children:"S.No"}),e(l,{align:"center",children:"Emp Id"}),e(l,{align:"center",children:"Project Name"}),e(l,{align:"center",children:"Employee Name"}),e(l,{align:"center",children:"Role"}),e(l,{align:"center",children:"Designation"}),e(l,{align:"center",children:"Actions"})]})}),e(re,{children:h==null?void 0:h.map((r,u)=>i(ge,{children:[e(l,{component:"th",scope:"row",children:m*b+u+1}),e(l,{align:"center",children:r.Emp_Id}),e(l,{align:"center",children:r.Project_Name}),e(l,{align:"center",children:r.Employee_name}),e(l,{align:"center",children:r.Role_Name}),e(l,{align:"center",children:r.Degesination}),i(l,{align:"center",children:[e(A,{title:"Edit",placement:"top",children:e(B,{children:e(ne,{color:"blue"})})}),e(A,{title:"Delete",placement:"top",children:e(B,{children:e(oe,{color:"red"})})})]})]},r.Emp_Id))})]})}),e(le,{component:"div",count:C,page:m,onPageChange:n,rowsPerPage:b,onRowsPerPageChange:a})]})})};export{be as default};
